<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>JazzDex</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Barlow+Condensed:wght@400;600;700&family=Barlow:wght@400;500&display=swap" rel="stylesheet">

<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BRAND COLORS â€” edit these to change the whole color scheme
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
:root {
  --navy:     #002B5C;  /* Jazz navy â€” primary bg / nav */
  --gold:     #F9A01B;  /* Jazz gold â€” accents / highlights */
  --teal:     #00B2A9;  /* Jazz teal â€” common rarity / catch button */
  --red:      #C8102E;  /* Jazz red â€” miss / error color */
  --cream:    #F5F0E8;  /* Off-white text */
  --bg:       #001525;  /* Page background (dark navy) */

  /* Rarity colors â€” change these to adjust each tier's glow/border */
  --common:   #00B2A9;
  --rare:     #7C4DFF;
  --epic:     #FF6D00;
  --legendary:#F9A01B;
}

* { margin:0; padding:0; box-sizing:border-box; }
body { background:var(--bg); color:var(--cream); font-family:'Barlow',sans-serif; min-height:100vh; overflow-x:hidden; }

/* â”€â”€ HEADER â”€â”€ */
header {
  background: linear-gradient(135deg, #002044, #001020);
  border-bottom: 3px solid var(--gold);
  padding: 10px 20px;
  display: flex; align-items: center; justify-content: space-between;
  position: sticky; top: 0; z-index: 100;
}
.logo { font-family:'Bebas Neue',sans-serif; font-size:2rem; letter-spacing:4px; color:var(--gold); text-shadow:0 0 24px rgba(249,160,27,.5); }
.logo span { color: var(--teal); }
.hdr-stats { font-family:'Barlow Condensed',sans-serif; font-size:.85rem; color:rgba(245,240,232,.55); display:flex; gap:20px; }
.hdr-stats strong { color:var(--gold); font-size:1.1rem; }

/* â”€â”€ NAV â”€â”€ */
nav { background:var(--navy); display:flex; justify-content:center; gap:4px; padding:7px 12px; border-bottom:1px solid rgba(249,160,27,.2); flex-wrap:wrap; }
.nav-btn { background:transparent; border:2px solid transparent; color:rgba(245,240,232,.55); font-family:'Barlow Condensed',sans-serif; font-size:.95rem; font-weight:700; letter-spacing:1px; padding:7px 18px; cursor:pointer; border-radius:4px; transition:all .2s; text-transform:uppercase; }
.nav-btn:hover { color:var(--gold); border-color:rgba(249,160,27,.3); }
.nav-btn.active { background:var(--gold); color:var(--navy); border-color:var(--gold); }

/* â”€â”€ VIEW SWITCHING â”€â”€ */
.view { display:none; }
.view.active { display:block; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SHARED COURT FLOOR â€” used on both Map and Court views
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.court-wrap {
  position:relative; width:100%; max-width:960px; margin:0 auto;
  overflow:hidden; border-left:4px solid var(--gold); border-right:4px solid var(--gold);
}
.court-wrap::before { content:''; display:block; padding-top:54%; }  /* 54% = aspect ratio */
.court-wrap svg.floor { position:absolute; inset:0; width:100%; height:100%; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SPAWN CHARACTERS (Map view)
   Players pop in, roam slowly, pop out when their timer runs out
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.spawn-char {
  position: absolute;
  transform: translate(-50%, -100%);  /* anchor at feet */
  cursor: pointer; z-index: 20;
  transition: left 9s ease-in-out, top 9s ease-in-out; /* smooth roam */
  display: flex; flex-direction: column; align-items: center;
}
.spawn-char.popin  { animation: pop-in  .4s cubic-bezier(.175,.885,.32,1.275) forwards; }
.spawn-char.popout { animation: pop-out .3s ease-in forwards; pointer-events:none; }
@keyframes pop-in  { from{transform:translate(-50%,-100%) scale(0);opacity:0} to{transform:translate(-50%,-100%) scale(1);opacity:1} }
@keyframes pop-out { to{transform:translate(-50%,-100%) scale(0) rotate(12deg);opacity:0} }

.char-body { display:flex; flex-direction:column; align-items:center; }
.char-shadow { width:26px; height:6px; background:rgba(0,0,0,.4); border-radius:50%; margin-top:-2px; animation:sh-bob 1.8s ease-in-out infinite; }
@keyframes sh-bob { 0%,100%{transform:scaleX(1)} 50%{transform:scaleX(.6)} }

/* Name tag under each character */
.char-tag { font-family:'Barlow Condensed',sans-serif; font-size:.6rem; font-weight:700; background:rgba(0,0,0,.8); padding:2px 6px; border-radius:3px; white-space:nowrap; margin-top:4px; letter-spacing:.4px; border-left:2px solid currentColor; }

/* Map legend bar */
.map-legend { background:var(--navy); padding:10px 20px; display:flex; gap:16px; flex-wrap:wrap; align-items:center; font-family:'Barlow Condensed',sans-serif; font-size:.82rem; border-top:1px solid rgba(249,160,27,.2); max-width:960px; margin:0 auto; }
.leg-item { display:flex; align-items:center; gap:6px; }
.leg-dot { width:10px; height:10px; border-radius:50%; }
.map-hint { color:rgba(245,240,232,.4); font-size:.78rem; margin-left:auto; font-style:italic; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CATCH MODAL â€” hoop shooting mini-game
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.modal-overlay { display:none; position:fixed; inset:0; background:rgba(0,8,25,.93); z-index:300; align-items:center; justify-content:center; backdrop-filter:blur(6px); }
.modal-overlay.open { display:flex; }
.catch-modal { background:linear-gradient(160deg,#001830,#002244); border:2px solid var(--gold); border-radius:18px; padding:24px 28px; width:min(440px,96vw); position:relative; box-shadow:0 0 80px rgba(249,160,27,.2); animation:modal-in .35s cubic-bezier(.175,.885,.32,1.275); }
@keyframes modal-in { from{transform:scale(.7);opacity:0} to{transform:scale(1);opacity:1} }
.modal-close { position:absolute; top:12px; right:14px; background:none; border:none; color:rgba(255,255,255,.4); font-size:1.4rem; cursor:pointer; }
.modal-close:hover { color:#fff; }

/* Player name + rarity in the modal header (no stats here) */
.modal-header { display:flex; align-items:center; gap:16px; margin-bottom:16px; }
.modal-char   { flex-shrink:0; }
.modal-info   { flex:1; }
.modal-name   { font-family:'Bebas Neue',sans-serif; font-size:1.8rem; letter-spacing:3px; color:var(--gold); line-height:1; }
.modal-rbadge { font-family:'Barlow Condensed',sans-serif; font-size:.72rem; font-weight:700; letter-spacing:2px; padding:2px 10px; border-radius:20px; text-transform:uppercase; display:inline-block; margin-top:4px; }

/* Hoop game section */
.hoop-section { background:rgba(0,0,0,.35); border-radius:12px; padding:16px; }
.hoop-title   { font-family:'Barlow Condensed',sans-serif; font-size:.85rem; color:rgba(245,240,232,.6); text-align:center; margin-bottom:10px; letter-spacing:1px; }
/* Single shot indicator */
.shot-row     { display:flex; justify-content:center; margin-bottom:10px; }
.shot-pip     { width:36px; height:36px; border-radius:50%; border:2px solid rgba(255,255,255,.2); background:rgba(0,0,0,.3); display:flex; align-items:center; justify-content:center; font-size:1rem; transition:all .25s; }
.shot-pip.made { background:var(--gold); border-color:var(--gold); transform:scale(1.1); }
.shot-pip.miss { background:var(--red);  border-color:var(--red); }

canvas#hoop-cv { width:100%; height:150px; display:block; border-radius:8px; background:rgba(0,0,10,.4); }

.throw-btn { margin-top:10px; width:100%; background:linear-gradient(135deg,var(--gold),#c87c00); color:var(--navy); border:none; font-family:'Bebas Neue',sans-serif; font-size:1.5rem; letter-spacing:3px; padding:10px; border-radius:8px; cursor:pointer; box-shadow:0 4px 18px rgba(249,160,27,.35); transition:transform .1s; }
.throw-btn:active   { transform:scale(.97); }
.throw-btn:disabled { opacity:.35; cursor:not-allowed; }

.catch-btn { display:none; margin-top:10px; width:100%; background:linear-gradient(135deg,var(--teal),#007a75); color:#fff; border:none; font-family:'Bebas Neue',sans-serif; font-size:1.5rem; letter-spacing:3px; padding:12px; border-radius:8px; cursor:pointer; animation:cpulse 1s ease-in-out infinite; box-shadow:0 0 20px rgba(0,178,169,.5); }
@keyframes cpulse { 0%,100%{box-shadow:0 0 20px rgba(0,178,169,.5)} 50%{box-shadow:0 0 40px rgba(0,178,169,.9)} }

.fail-msg    { display:none; text-align:center; color:var(--red); font-family:'Barlow Condensed',sans-serif; font-size:1rem; margin-top:8px; }

.success-screen   { display:none; text-align:center; padding:16px 0; }
.success-screen h3 { font-family:'Bebas Neue',sans-serif; font-size:2rem; color:var(--gold); letter-spacing:4px; }
.success-screen p  { font-family:'Barlow Condensed',sans-serif; color:rgba(245,240,232,.7); }
.burst { font-size:2.8rem; display:block; margin-bottom:8px; animation:burst .5s ease 4; }
@keyframes burst { 0%,100%{transform:scale(1)} 50%{transform:scale(1.4)} }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PLAYER CARDS â€” flip on click (front=photo, back=stats)
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#cards-view > div { padding:20px; max-width:960px; margin:0 auto; }

.view-title { font-family:'Bebas Neue',sans-serif; font-size:1.8rem; letter-spacing:3px; color:var(--gold); margin-bottom:16px; display:flex; align-items:center; gap:10px; }
.view-title::after { content:''; flex:1; height:2px; background:linear-gradient(90deg,rgba(249,160,27,.5),transparent); }

.cards-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(185px,1fr)); gap:16px; }

/* Card flip container */
.card-flip-wrap {
  perspective: 700px;
  height: 270px;
  cursor: pointer;
}
/* The inner card that actually rotates */
.card-inner {
  position: relative; width:100%; height:100%;
  transform-style: preserve-3d;
  transition: transform .55s cubic-bezier(.4,0,.2,1);
  border-radius: 14px;
}
.card-flip-wrap.flipped .card-inner { transform: rotateY(180deg); }

/* Both faces share these styles */
.card-face {
  position: absolute; inset:0;
  backface-visibility: hidden;
  border-radius: 14px;
  overflow: hidden;
  background: linear-gradient(160deg, #001830, var(--navy));
}
/* Back face is pre-rotated so it shows when flipped */
.card-back { transform: rotateY(180deg); }

/* Rarity borders â€” change colors here per tier */
.card-flip-wrap[data-r="common"]    .card-face { border:2px solid var(--common);    box-shadow:0 4px 16px rgba(0,178,169,.2);   }
.card-flip-wrap[data-r="rare"]      .card-face { border:2px solid var(--rare);      box-shadow:0 4px 16px rgba(124,77,255,.25); }
.card-flip-wrap[data-r="epic"]      .card-face { border:2px solid var(--epic);      box-shadow:0 4px 20px rgba(255,109,0,.3);   }
.card-flip-wrap[data-r="legendary"] .card-face { border:2px solid var(--legendary); box-shadow:0 4px 28px rgba(249,160,27,.4); animation:cardleg 3s ease-in-out infinite; }
@keyframes cardleg { 0%,100%{box-shadow:0 4px 28px rgba(249,160,27,.4)} 50%{box-shadow:0 4px 50px rgba(249,160,27,.7)} }

/* FRONT face â€” big photo */
.card-front-img {
  width:100%; height:100%;
  object-fit: cover;
  display: block;
}
/* Overlay at the bottom of the photo side */
.card-front-overlay {
  position: absolute; bottom:0; left:0; right:0;
  background: linear-gradient(transparent, rgba(0,0,0,.75));
  padding: 20px 10px 10px;
}
.card-front-overlay .card-pname  { font-family:'Bebas Neue',sans-serif; font-size:1.25rem; letter-spacing:2px; color:#fff; }
.card-front-overlay .card-rbadge { font-family:'Barlow Condensed',sans-serif; font-size:.6rem; font-weight:700; letter-spacing:2px; padding:2px 7px; border-radius:20px; text-transform:uppercase; display:inline-block; margin-top:2px; }

/* FRONT face â€” no photo uploaded yet */
.card-front-noimg {
  display:flex; flex-direction:column; align-items:center; justify-content:center; height:100%;
  gap: 8px;
}
.card-front-noimg .card-char { height:90px; display:flex; align-items:flex-end; justify-content:center; }
.card-front-noimg .card-pname { font-family:'Bebas Neue',sans-serif; font-size:1.15rem; letter-spacing:2px; text-align:center; padding:0 8px 2px; }
.card-front-noimg .card-era   { font-family:'Barlow Condensed',sans-serif; font-size:.68rem; color:rgba(245,240,232,.4); text-align:center; }

/* BACK face â€” stats */
.card-back-inner { padding:14px; height:100%; display:flex; flex-direction:column; }
.card-back-num    { font-family:'Barlow Condensed',sans-serif; font-size:.7rem; color:rgba(245,240,232,.35); margin-bottom:4px; }
.card-back-name   { font-family:'Bebas Neue',sans-serif; font-size:1.2rem; letter-spacing:2px; color:var(--gold); line-height:1; margin-bottom:2px; }
.card-back-era    { font-family:'Barlow Condensed',sans-serif; font-size:.68rem; color:rgba(245,240,232,.4); margin-bottom:10px; }
.card-back-stats  { background:rgba(0,0,0,.3); border-radius:8px; padding:8px 10px; display:grid; grid-template-columns:1fr 1fr; gap:4px 8px; margin-bottom:8px; }
.srow { display:flex; justify-content:space-between; font-family:'Barlow Condensed',sans-serif; font-size:.82rem; }
.sl { color:rgba(245,240,232,.45); } .sv { font-weight:600; }
.card-back-quote  { font-family:'Barlow Condensed',sans-serif; font-size:.7rem; color:rgba(245,240,232,.4); font-style:italic; text-align:center; margin-top:auto; padding-top:6px; }
.card-back-hint   { font-family:'Barlow Condensed',sans-serif; font-size:.6rem; color:rgba(245,240,232,.25); text-align:center; margin-top:4px; }

/* Locked (not yet caught) card styling */
.card-flip-wrap.locked .card-inner { pointer-events:none; }
.card-flip-wrap.locked .card-face  { filter:brightness(.2) saturate(0); }
.card-flip-wrap.locked .card-face::after { content:'?'; position:absolute; inset:0; display:flex; align-items:center; justify-content:center; font-family:'Bebas Neue',sans-serif; font-size:4rem; color:rgba(255,255,255,.3); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   JAZZDEX GRID
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#dex-view > div  { padding:20px; max-width:960px; margin:0 auto; }
.dex-bar-wrap    { background:rgba(0,0,0,.3); border-radius:8px; padding:12px 16px; margin-bottom:16px; display:flex; align-items:center; gap:14px; }
.dex-track       { flex:1; height:12px; background:rgba(0,0,0,.4); border-radius:6px; overflow:hidden; border:1px solid rgba(249,160,27,.2); }
.dex-fill        { height:100%; background:linear-gradient(90deg,var(--teal),var(--gold)); border-radius:6px; transition:width .5s; }
.dex-frac        { font-family:'Bebas Neue',sans-serif; font-size:1.4rem; color:var(--gold); letter-spacing:2px; white-space:nowrap; }
.dex-grid        { display:grid; grid-template-columns:repeat(auto-fill,minmax(78px,1fr)); gap:8px; }
.dex-slot        { border:2px solid rgba(249,160,27,.15); border-radius:10px; padding:7px 4px; text-align:center; background:rgba(0,20,50,.5); transition:all .2s; }
.dex-slot.got    { border-color:var(--gold); background:rgba(0,30,70,.8); cursor:pointer; }
.dex-slot.got:hover { transform:scale(1.06); }
.dex-char        { display:flex; justify-content:center; align-items:flex-end; height:50px; margin-bottom:3px; }
.dex-pname       { font-family:'Barlow Condensed',sans-serif; font-size:.62rem; font-weight:700; letter-spacing:.3px; }
.dex-slot:not(.got) .dex-char  { filter:brightness(0); }
.dex-slot:not(.got) .dex-pname { color:rgba(255,255,255,.15); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   COURT VIEW â€” roaming players + canvas ball overlay
   The canvas sits ABOVE the player divs (z-index) so ball
   is always drawn in front of players.
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#court-view    { padding:0; }
.roam-court    { position:relative; width:100%; max-width:960px; margin:0 auto; overflow:hidden; border:4px solid var(--gold); }
.roam-court::before { content:''; display:block; padding-top:54%; }
.roam-court svg.floor  { position:absolute; inset:0; width:100%; height:100%; z-index:1; }
/* Player divs sit above the floor SVG */
.roamer-div    { position:absolute; transform:translate(-50%,-100%); pointer-events:none; transition:left 4.5s ease-in-out, top 4.5s ease-in-out; display:flex; flex-direction:column; align-items:center; z-index:2; }
.roamer-tag    { font-family:'Barlow Condensed',sans-serif; font-size:.6rem; font-weight:700; background:rgba(0,0,0,.75); padding:2px 5px; border-radius:3px; white-space:nowrap; margin-top:3px; }
/* Canvas ABOVE player divs so ball draws in front */
.roam-court canvas#court-cv { position:absolute; inset:0; width:100%; height:100%; pointer-events:none; z-index:3; }

.court-footer  { background:var(--navy); padding:10px 20px; text-align:center; font-family:'Barlow Condensed',sans-serif; font-size:.9rem; color:rgba(245,240,232,.5); border-top:1px solid rgba(249,160,27,.2); max-width:960px; margin:0 auto; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FACES UPLOAD PANEL
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#faces-view > div { padding:20px; max-width:960px; margin:0 auto; }
.faces-info   { font-family:'Barlow Condensed',sans-serif; font-size:.95rem; color:rgba(245,240,232,.6); margin-bottom:16px; line-height:1.6; }
.faces-grid   { display:grid; grid-template-columns:repeat(auto-fill,minmax(128px,1fr)); gap:14px; }
.face-slot    { background:rgba(0,20,50,.6); border:2px dashed rgba(249,160,27,.25); border-radius:12px; padding:12px 8px; text-align:center; transition:border-color .2s; }
.face-slot:hover { border-color:rgba(249,160,27,.7); }
.face-slot label  { cursor:pointer; display:flex; flex-direction:column; align-items:center; gap:6px; }
.face-preview { width:54px; height:54px; border-radius:50%; overflow:hidden; border:2px solid rgba(255,255,255,.15); background:rgba(0,0,0,.3); display:flex; align-items:center; justify-content:center; font-size:1.5rem; }
.face-preview img { width:100%; height:100%; object-fit:cover; }
.face-pname   { font-family:'Barlow Condensed',sans-serif; font-size:.72rem; font-weight:700; color:var(--cream); letter-spacing:.4px; }
.face-sub     { font-size:.6rem; color:rgba(245,240,232,.4); }
.face-slot input[type=file] { display:none; }

/* â”€â”€ RARITY BADGE COLORS â”€â”€ */
.rarity-common    { color:var(--common);  background:rgba(0,178,169,.15); }
.rarity-rare      { color:#a87fff;        background:rgba(124,77,255,.15); }
.rarity-epic      { color:#ff9940;        background:rgba(255,109,0,.15); }
.rarity-legendary { color:var(--gold);    background:rgba(249,160,27,.15); }
</style>
</head>
<body>

<header>
  <div class="logo">Jazz<span>Dex</span></div>
  <div class="hdr-stats"><span>CAUGHT <strong id="caught-count">0</strong></span><span>/ 12</span></div>
</header>

<nav>
  <button class="nav-btn active" onclick="showView('map-view',this)">ğŸ—º Map</button>
  <button class="nav-btn" onclick="showView('cards-view',this)">ğŸƒ Cards</button>
  <button class="nav-btn" onclick="showView('dex-view',this)">ğŸ“‹ JazzDex</button>
  <button class="nav-btn" onclick="showView('court-view',this)">ğŸŸ Court</button>
  <button class="nav-btn" onclick="showView('faces-view',this)">ğŸ“¸ Faces</button>
</nav>

<!-- â•â•â•â•â•â•â• MAP VIEW â•â•â•â•â•â•â• -->
<div id="map-view" class="view active">
  <div class="court-wrap" id="court-map">
    <!-- Court floor SVG â€” edit viewBox/lines here to change court layout -->
    <svg class="floor" viewBox="0 0 900 490" xmlns="http://www.w3.org/2000/svg">
      <defs>
        <radialGradient id="fg" cx="50%" cy="50%" r="60%">
          <stop offset="0%"   stop-color="#D4A520"/>
          <stop offset="100%" stop-color="#9A7010"/>
        </radialGradient>
      </defs>
      <rect width="900" height="490" fill="url(#fg)"/>
      <!-- Wood grain lines -->
      <g opacity=".06" stroke="#000" stroke-width="1.5">
        <line x1="0" y1="40" x2="900" y2="40"/><line x1="0" y1="80" x2="900" y2="80"/>
        <line x1="0" y1="120" x2="900" y2="120"/><line x1="0" y1="160" x2="900" y2="160"/>
        <line x1="0" y1="200" x2="900" y2="200"/><line x1="0" y1="240" x2="900" y2="240"/>
        <line x1="0" y1="280" x2="900" y2="280"/><line x1="0" y1="320" x2="900" y2="320"/>
        <line x1="0" y1="360" x2="900" y2="360"/><line x1="0" y1="400" x2="900" y2="400"/>
        <line x1="0" y1="440" x2="900" y2="440"/>
      </g>
      <!-- Court lines -->
      <rect x="30" y="20" width="840" height="450" fill="none" stroke="rgba(0,43,92,.8)" stroke-width="3" rx="3"/>
      <circle cx="450" cy="245" r="65" fill="rgba(0,43,92,.15)" stroke="rgba(0,43,92,.65)" stroke-width="2.5"/>
      <circle cx="450" cy="245" r="4" fill="rgba(0,43,92,.6)"/>
      <line x1="450" y1="20" x2="450" y2="470" stroke="rgba(0,43,92,.55)" stroke-width="2.5"/>
      <!-- Paint boxes -->
      <rect x="30" y="158" width="185" height="174" fill="rgba(0,43,92,.2)" stroke="rgba(0,43,92,.65)" stroke-width="2.5"/>
      <rect x="685" y="158" width="185" height="174" fill="rgba(0,43,92,.2)" stroke="rgba(0,43,92,.65)" stroke-width="2.5"/>
      <!-- Free-throw arcs -->
      <path d="M30 158 A92 92 0 0 1 215 158" fill="none" stroke="rgba(0,43,92,.65)" stroke-width="2.5"/>
      <path d="M685 158 A92 92 0 0 0 870 158" fill="none" stroke="rgba(0,43,92,.65)" stroke-width="2.5"/>
      <!-- 3-point arcs -->
      <path d="M30 75 Q270 68 270 245 Q270 422 30 415" fill="none" stroke="rgba(0,43,92,.55)" stroke-width="2.5"/>
      <path d="M870 75 Q630 68 630 245 Q630 422 870 415" fill="none" stroke="rgba(0,43,92,.55)" stroke-width="2.5"/>
      <!-- Baskets -->
      <circle cx="68" cy="245" r="17" fill="none" stroke="rgba(0,43,92,.85)" stroke-width="2.5"/>
      <line x1="30" y1="245" x2="85" y2="245" stroke="rgba(0,43,92,.65)" stroke-width="2"/>
      <circle cx="832" cy="245" r="17" fill="none" stroke="rgba(0,43,92,.85)" stroke-width="2.5"/>
      <line x1="815" y1="245" x2="870" y2="245" stroke="rgba(0,43,92,.65)" stroke-width="2"/>
      <!-- Jazz wordmark â€” change text here -->
      <text x="450" y="254" text-anchor="middle" font-size="30" font-family="Georgia,serif" font-weight="bold" fill="rgba(0,43,92,.3)" letter-spacing="6">JAZZ</text>
    </svg>
    <!-- Spawn characters are injected here by JS -->
  </div>
  <div class="map-legend">
    <div class="leg-item"><div class="leg-dot" style="background:var(--common)"></div>Common</div>
    <div class="leg-item"><div class="leg-dot" style="background:var(--rare)"></div>Rare</div>
    <div class="leg-item"><div class="leg-dot" style="background:var(--epic)"></div>Epic</div>
    <div class="leg-item"><div class="leg-dot" style="background:var(--legendary)"></div>Legendary</div>
    <span class="map-hint">Tap a player to catch â€” rare ones vanish fast!</span>
  </div>
</div>

<!-- â•â•â•â•â•â•â• CARDS VIEW â•â•â•â•â•â•â• -->
<div id="cards-view" class="view">
  <div>
    <div class="view-title">Player Cards</div>
    <div class="cards-grid" id="cards-grid"></div>
  </div>
</div>

<!-- â•â•â•â•â•â•â• JAZZDEX VIEW â•â•â•â•â•â•â• -->
<div id="dex-view" class="view">
  <div>
    <div class="view-title">JazzDex</div>
    <div class="dex-bar-wrap">
      <div class="dex-track"><div class="dex-fill" id="dex-fill" style="width:0%"></div></div>
      <div class="dex-frac"><span id="dex-n">0</span>/12</div>
    </div>
    <div class="dex-grid" id="dex-grid"></div>
  </div>
</div>

<!-- â•â•â•â•â•â•â• COURT VIEW â•â•â•â•â•â•â• -->
<div id="court-view" class="view">
  <div class="roam-court" id="roam-court">
    <!-- Same floor SVG as map (copy-paste) -->
    <svg class="floor" viewBox="0 0 900 490" xmlns="http://www.w3.org/2000/svg">
      <defs><radialGradient id="fg2" cx="50%" cy="50%" r="60%"><stop offset="0%" stop-color="#D4A520"/><stop offset="100%" stop-color="#9A7010"/></radialGradient></defs>
      <rect width="900" height="490" fill="url(#fg2)"/>
      <g opacity=".06" stroke="#000" stroke-width="1.5"><line x1="0" y1="40" x2="900" y2="40"/><line x1="0" y1="80" x2="900" y2="80"/><line x1="0" y1="120" x2="900" y2="120"/><line x1="0" y1="160" x2="900" y2="160"/><line x1="0" y1="200" x2="900" y2="200"/><line x1="0" y1="240" x2="900" y2="240"/><line x1="0" y1="280" x2="900" y2="280"/><line x1="0" y1="320" x2="900" y2="320"/><line x1="0" y1="360" x2="900" y2="360"/><line x1="0" y1="400" x2="900" y2="400"/><line x1="0" y1="440" x2="900" y2="440"/></g>
      <rect x="30" y="20" width="840" height="450" fill="none" stroke="rgba(0,43,92,.8)" stroke-width="3"/>
      <circle cx="450" cy="245" r="65" fill="rgba(0,43,92,.15)" stroke="rgba(0,43,92,.65)" stroke-width="2.5"/>
      <line x1="450" y1="20" x2="450" y2="470" stroke="rgba(0,43,92,.55)" stroke-width="2.5"/>
      <rect x="30" y="158" width="185" height="174" fill="rgba(0,43,92,.2)" stroke="rgba(0,43,92,.65)" stroke-width="2.5"/>
      <rect x="685" y="158" width="185" height="174" fill="rgba(0,43,92,.2)" stroke="rgba(0,43,92,.65)" stroke-width="2.5"/>
      <circle cx="68" cy="245" r="17" fill="none" stroke="rgba(0,43,92,.85)" stroke-width="2.5"/>
      <circle cx="832" cy="245" r="17" fill="none" stroke="rgba(0,43,92,.85)" stroke-width="2.5"/>
      <text x="450" y="254" text-anchor="middle" font-size="30" font-family="Georgia,serif" font-weight="bold" fill="rgba(0,43,92,.3)" letter-spacing="6">JAZZ</text>
    </svg>
    <!-- canvas goes above player divs â€” see z-index in CSS -->
    <canvas id="court-cv"></canvas>
    <!-- Roamer divs are injected here by JS -->
  </div>
  <div class="court-footer" id="court-footer">Catch players on the map to see them roam here!</div>
</div>

<!-- â•â•â•â•â•â•â• FACES VIEW â•â•â•â•â•â•â• -->
<div id="faces-view" class="view">
  <div>
    <div class="view-title">Upload Player Faces</div>
    <div class="faces-info">
      Upload a photo for each player and their face will fill their head in-game and on the front of their card.
      Square crops or headshots work best. Tap any slot to choose a photo.
    </div>
    <div class="faces-grid" id="faces-grid"></div>
  </div>
</div>

<!-- â•â•â•â•â•â•â• CATCH MODAL â•â•â•â•â•â•â• -->
<div class="modal-overlay" id="catch-modal">
  <div class="catch-modal">
    <button class="modal-close" onclick="closeModal()">âœ•</button>
    <div id="modal-body"></div>
  </div>
</div>


<script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—
   â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â•šâ•â•â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—
   â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘
   â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘
   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘
   â•šâ•â•â•â•â•â• â•šâ•â•  â•šâ•â•   â•šâ•â•   â•šâ•â•  â•šâ•â•
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

   â–¶  WANT TO ADD OR EDIT A PLAYER?
      Find the PLAYERS array below and follow the template.
      Required fields: id, name, short, rarity, era, ppg, apg, rpg, blk, quote, num

   â–¶  WANT TO CHANGE RARITY SPAWN BEHAVIOR?
      Find RARITY_SPAWN below â€” adjust interval (how often) and
      duration (how long they stay visible).

   â–¶  WANT TO CHANGE CHARACTER APPEARANCE?
      Find buildChar() â€” edit the SVG inside to change the body.
      Shirt colors are in SHIRT_COLORS.

   â–¶  WANT TO CHANGE COLORS?
      Edit the :root CSS variables at the top of <style>.
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */


/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   RARITY COLOR MAP
   These map rarity names â†’ hex color used for glows, borders, tags.
   Change a value here to update all uses of that rarity's color.
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
const RARITY_COLORS = {
  common:    '#00B2A9',
  rare:      '#7C4DFF',
  epic:      '#FF6D00',
  legendary: '#F9A01B',
};

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   SHIRT COLORS â€” the jersey body color per rarity tier.
   Change these to give different tiers different uniform looks.
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
const SHIRT_COLORS = {
  common:    '#00868a',  /* teal-ish */
  rare:      '#5533aa',  /* purple   */
  epic:      '#aa3300',  /* burnt orange */
  legendary: '#aa7700',  /* deep gold */
};

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   RARITY SPAWN CONFIG
   interval : ms between spawn attempts (longer = rarer feel)
   duration : ms the player stays visible before vanishing
   Higher rarity = longer interval, shorter duration = harder to catch
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
const RARITY_SPAWN = {
  common:    { interval: 8000,  duration: 18000 },
  rare:      { interval: 14000, duration: 9000  },
  epic:      { interval: 24000, duration: 6000  },
  legendary: { interval: 42000, duration: 3500  },
};

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   PLAYERS ARRAY
   â–¶ To add a player: copy any object, give it a unique id, fill fields.
   â–¶ To remove a player: delete the object and update the "/12" counts
     in the HTML header and DEX section.

   Fields:
     id       â€“ unique number (1â€“N)
     name     â€“ full display name
     short    â€“ short name for tags and dex
     rarity   â€“ 'common' | 'rare' | 'epic' | 'legendary'
     era      â€“ years with the team (shown on card back)
     ppg/apg/rpg/blk â€“ career stats with Jazz
     quote    â€“ flavor text on card back
     num      â€“ jersey number shown on body
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
const PLAYERS = [
  { id:1,  name:'Karl Malone',      short:'Malone',   rarity:'legendary', era:'1985â€“2003', ppg:25.0, apg:3.6,  rpg:10.1, blk:1.0, quote:'The Mailman always delivers.', num:'32' },
  { id:2,  name:'John Stockton',    short:'Stockton', rarity:'legendary', era:'1984â€“2003', ppg:13.1, apg:10.5, rpg:2.7,  blk:0.2, quote:'Greatest PG in NBA history.',  num:'12' },
  { id:3,  name:'Pete Maravich',    short:'Pistol',   rarity:'epic',      era:'1974â€“1980', ppg:24.4, apg:5.4,  rpg:4.2,  blk:0.2, quote:'Pistol Pete â€” pure magic.',   num:'7'  },
  { id:4,  name:'Adrian Dantley',   short:'Dantley',  rarity:'epic',      era:'1979â€“1986', ppg:26.6, apg:2.9,  rpg:5.7,  blk:0.3, quote:'A scoring machine.',           num:'4'  },
  { id:5,  name:'Donovan Mitchell', short:'Spida',    rarity:'rare',      era:'2017â€“2021', ppg:23.9, apg:4.4,  rpg:4.4,  blk:0.5, quote:'Spida climbs any wall.',       num:'45' },
  { id:6,  name:'Rudy Gobert',      short:'Gobert',   rarity:'rare',      era:'2013â€“2022', ppg:14.3, apg:1.3,  rpg:13.5, blk:2.3, quote:'The Stifle Tower.',            num:'27' },
  { id:7,  name:'Mark Eaton',       short:'Eaton',    rarity:'rare',      era:'1982â€“1993', ppg:6.0,  apg:0.6,  rpg:7.9,  blk:3.5, quote:'No easy buckets.',             num:'53' },
  { id:8,  name:'Jeff Hornacek',    short:'Hornacek', rarity:'common',    era:'1994â€“2000', ppg:16.6, apg:4.7,  rpg:3.3,  blk:0.2, quote:"A clutch shooter's shooter.",  num:'14' },
  { id:9,  name:'Joe Ingles',       short:'Ingles',   rarity:'common',    era:'2014â€“2022', ppg:8.5,  apg:3.3,  rpg:3.1,  blk:0.3, quote:'Aussie wit & threes.',         num:'2'  },
  { id:10, name:'Bojan Bogdanovic', short:'Bojan',    rarity:'common',    era:'2019â€“2022', ppg:18.2, apg:2.1,  rpg:3.7,  blk:0.2, quote:'Automatic from corner.',       num:'44' },
  { id:11, name:'Darrell Griffith', short:'Griff',    rarity:'rare',      era:'1980â€“1991', ppg:16.2, apg:2.2,  rpg:3.6,  blk:0.5, quote:'Dr. Dunkenstein flies.',       num:'35' },
  { id:12, name:'Jordan Clarkson',  short:'Clarkson', rarity:'common',    era:'2019â€“Now',  ppg:17.4, apg:2.5,  rpg:3.3,  blk:0.2, quote:'Sixth Man energy.',            num:'00' },
];


/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   GAME STATE
   These track what the player has caught, face uploads,
   active spawns on the map, and court animation handles.
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
let caught       = new Set();   // Set of caught player IDs
let faceImages   = {};          // { [playerId]: dataURL }
let activeSpawns = {};          // { [playerId]: { el, roamId, despawnId } }
let roamPos      = {};          // { [playerId]: { x%, y% } } â€” court positions
let roamTimer    = null;        // interval handle for court roaming
let courtAF      = null;        // requestAnimationFrame handle for court canvas
let currentTarget= null;        // player currently being caught
let hoopAF       = null;        // requestAnimationFrame handle for hoop game


/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CHARACTER SVG BUILDER
   â–¶ This is the main function that draws each player figure.
   â–¶ The head is a circle filled with the player's uploaded face photo,
     or a plain circle if no photo has been uploaded yet.
   â–¶ To change body proportions: edit the SVG coordinates below.
   â–¶ size parameter = rendered px width/height (viewBox is 0 0 56 60).
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function buildChar(p, size = 56) {
  const shirt = SHIRT_COLORS[p.rarity];   // jersey color
  const glow  = RARITY_COLORS[p.rarity]; // rarity glow color
  const face  = faceImages[p.id] || null;
  // Each player bobs at a slightly different speed â€” staggered by id
  const bobDur = (1.4 + (p.id % 5) * 0.18) + 's';

  /* HEAD CONTENT:
     If a face photo has been uploaded, fill the entire head circle with it.
     Otherwise show a blank head circle. */
  const headFill = face ? 'transparent' : '#dfc090';
  const faceEl   = face
    ? `<image href="${face}" x="13" y="3" width="30" height="30" clip-path="url(#hc${p.id})"/>`
    : `<!-- No face uploaded â€” default blank head -->`;

  return `<svg width="${size}" height="${Math.round(size * 1.07)}" viewBox="0 0 56 60"
    xmlns="http://www.w3.org/2000/svg" style="overflow:visible;display:block">
  <defs>
    <!-- Circular clip for the face photo â€” matches the head circle -->
    <clipPath id="hc${p.id}"><circle cx="28" cy="18" r="15"/></clipPath>
  </defs>

  <!-- â”€â”€ WHOLE-BODY BOB (up/down) â”€â”€ -->
  <g style="animation:chbob${p.id} ${bobDur} ease-in-out infinite">
    <style>@keyframes chbob${p.id}{0%,100%{transform:translateY(0)}50%{transform:translateY(-3px)}}</style>

    <!-- â”€â”€ SHOES â”€â”€ change fill to change shoe color -->
    <ellipse cx="20" cy="59" rx="7"   ry="2.8" fill="#111"/>
    <ellipse cx="36" cy="59" rx="7"   ry="2.8" fill="#111"/>
    <!-- â”€â”€ LEGS â”€â”€ -->
    <rect x="16" y="46" width="9"  height="14" rx="4" fill="${shirt}" opacity=".85"/>
    <rect x="31" y="46" width="9"  height="14" rx="4" fill="${shirt}" opacity=".85"/>
    <!-- â”€â”€ TORSO â”€â”€ -->
    <rect x="13" y="29" width="30" height="20" rx="7" fill="${shirt}"/>
    <!-- â”€â”€ JERSEY NUMBER â”€â”€ change font-size to resize the number -->
    <text x="28" y="43" text-anchor="middle" font-size="7"
      font-family="Arial Black,sans-serif" font-weight="900"
      fill="rgba(255,255,255,.88)">${p.num}</text>
    <!-- â”€â”€ ARMS â”€â”€ -->
    <rect x="4"  y="30" width="11" height="7" rx="3.5" fill="${shirt}" opacity=".9"/>
    <rect x="41" y="30" width="11" height="7" rx="3.5" fill="${shirt}" opacity=".9"/>
    <!-- â”€â”€ NECK â”€â”€ change fill to change skin color -->
    <rect x="24" y="26" width="8"  height="6" rx="3"   fill="#dfc090"/>

    <!-- â”€â”€ HEAD â€” bobble: sways independently from the body â”€â”€ -->
    <g style="animation:hdsway${p.id} ${bobDur} ease-in-out infinite;transform-origin:28px 18px">
      <style>@keyframes hdsway${p.id}{0%,100%{transform:rotate(-2.5deg)}50%{transform:rotate(2.5deg)}}</style>

      <!-- Head circle â€” this is where the face fills in -->
      <circle cx="28" cy="18" r="15" fill="${headFill}"/>
      <!-- Face photo (clipped to circle) -->
      ${faceEl}
      <!-- Subtle outline so head reads cleanly against any background -->
      <circle cx="28" cy="18" r="15" fill="none" stroke="rgba(0,0,0,.12)" stroke-width="1"/>
      <!-- Hair strip across the top â€” same color as jersey -->
      <path d="M13 11 Q28 2 43 11" fill="${shirt}" opacity=".55"/>
    </g>

    <!-- â”€â”€ RARITY BADGE (top-right corner) â”€â”€ -->
    ${p.rarity === 'legendary' ? `<text x="47" y="7" font-size="8" fill="${glow}">â˜…</text>` : ''}
    ${p.rarity === 'epic'      ? `<text x="47" y="7" font-size="7" fill="${glow}">â—†</text>` : ''}
  </g>
</svg>`;
}


/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FACES UPLOAD PANEL
   Renders the grid of upload slots. Each slot stores the image as a
   dataURL in faceImages[id] and refreshes all open views.
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function renderFaces() {
  const grid = document.getElementById('faces-grid');
  if (!grid) return;
  grid.innerHTML = PLAYERS.map(p => {
    const col     = RARITY_COLORS[p.rarity];
    const hasFace = !!faceImages[p.id];
    return `<div class="face-slot" style="border-color:${col}55">
      <label>
        <div class="face-preview" id="fp-${p.id}">
          ${hasFace ? `<img src="${faceImages[p.id]}"/>` : 'ğŸ“·'}
        </div>
        <div class="face-pname">${p.short}</div>
        <div class="face-sub" style="color:${col}">${p.rarity}</div>
        <input type="file" accept="image/*" onchange="loadFace(${p.id},this)">
      </label>
    </div>`;
  }).join('');
}

function loadFace(id, input) {
  const file = input.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = e => {
    faceImages[id] = e.target.result;  // save dataURL

    // Update the preview thumbnail in the faces panel
    const prev = document.getElementById('fp-' + id);
    if (prev) prev.innerHTML = `<img src="${e.target.result}"/>`;

    // Refresh whichever view is currently active
    if (document.getElementById('cards-view').classList.contains('active')) renderCards();
    if (document.getElementById('dex-view').classList.contains('active'))   renderDex();
    if (document.getElementById('court-view').classList.contains('active')) rebuildRoamers();

    // Update the character in any open catch modal
    const mc = document.getElementById('modal-char');
    if (mc && currentTarget && currentTarget.id === id)
      mc.innerHTML = buildChar(currentTarget, 68);

    // Update the character on the map if still spawned
    const spawnBody = document.querySelector(`.spawn-char[data-id="${id}"] .char-body`);
    if (spawnBody) spawnBody.innerHTML = buildChar(PLAYERS.find(pl => pl.id === id), 50);
  };
  reader.readAsDataURL(file);
}


/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SPAWN SYSTEM
   Each player has their own schedule. On first load they get a
   random initial delay so they don't all pop at once.
   After each appearance, the next one is re-scheduled.
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function scheduleAll() {
  PLAYERS.forEach(p => {
    // Stagger initial spawns randomly within the first interval window
    const initialDelay = Math.random() * RARITY_SPAWN[p.rarity].interval * 0.7;
    setTimeout(() => trySpawn(p), initialDelay);
  });
}

function trySpawn(p) {
  if (caught.has(p.id)) return;    // already caught â€” never spawn again
  if (activeSpawns[p.id]) return;  // already on map
  const cfg  = RARITY_SPAWN[p.rarity];
  const glow = RARITY_COLORS[p.rarity];
  const court = document.getElementById('court-map');

  // Random start position (keep away from edges)
  let x = 12 + Math.random() * 76;
  let y = 14 + Math.random() * 72;

  // Build the DOM element
  const wrap = document.createElement('div');
  wrap.className = 'spawn-char';
  wrap.dataset.id = p.id;
  wrap.style.cssText = `left:${x}%;top:${y}%;filter:drop-shadow(0 0 ${p.rarity === 'legendary' ? '12' : '6'}px ${glow})`;

  const body = document.createElement('div');
  body.className = 'char-body';
  body.innerHTML = buildChar(p, 50);

  const shadow = document.createElement('div');
  shadow.className = 'char-shadow';

  const tag = document.createElement('div');
  tag.className = 'char-tag';
  tag.style.color = glow;
  tag.textContent = p.short;

  body.appendChild(shadow);
  wrap.appendChild(body);
  wrap.appendChild(tag);
  court.appendChild(wrap);
  requestAnimationFrame(() => wrap.classList.add('popin'));
  wrap.addEventListener('click', () => openCatch(p.id));

  // Slowly roam while visible
  const roamId = setInterval(() => {
    if (!activeSpawns[p.id]) return;
    x = Math.max(8,  Math.min(92, x + (Math.random() - 0.5) * 10));
    y = Math.max(10, Math.min(88, y + (Math.random() - 0.5) * 10));
    wrap.style.left = x + '%';
    wrap.style.top  = y + '%';
  }, 3200);

  // Auto-despawn after duration
  const despawnId = setTimeout(() => doDeSpawn(p.id), cfg.duration);
  activeSpawns[p.id] = { el: wrap, roamId, despawnId };

  // Schedule the next appearance after this one is gone
  const nextIn = cfg.interval * (0.8 + Math.random() * 0.6);
  setTimeout(() => { if (!caught.has(p.id)) trySpawn(p); }, cfg.duration + nextIn);
}

function doDeSpawn(id) {
  const s = activeSpawns[id];
  if (!s) return;
  clearInterval(s.roamId);
  clearTimeout(s.despawnId);
  s.el.classList.add('popout');
  setTimeout(() => s.el.remove(), 350);
  delete activeSpawns[id];
}


/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CATCH MODAL
   Opens when a player is tapped on the map.
   Only shows name + rarity â€” no stats (per request).
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function openCatch(id) {
  currentTarget = PLAYERS.find(p => p.id === id);
  const p = currentTarget;

  document.getElementById('modal-body').innerHTML = `
    <div class="modal-header">
      <div class="modal-char" id="modal-char">${buildChar(p, 68)}</div>
      <div class="modal-info">
        <div class="modal-name">${p.name}</div>
        <span class="modal-rbadge rarity-${p.rarity}">${p.rarity.toUpperCase()}</span>
        <!-- Stats intentionally NOT shown here â€” they live on the card back -->
      </div>
    </div>
    <div class="hoop-section">
      <div class="hoop-title">MAKE THE SHOT TO CATCH!</div>
      <div class="shot-row">
        <div class="shot-pip" id="sp0">ğŸ€</div>
      </div>
      <canvas id="hoop-cv" width="380" height="150"></canvas>
      <button class="throw-btn" id="throw-btn" onclick="doThrow()">ğŸ€ THROW</button>
    </div>
    <button class="catch-btn" id="catch-btn" onclick="doCatch()">âš¡ CATCH ${p.short.toUpperCase()}!</button>
    <div class="fail-msg" id="fail-msg">ğŸ˜“ Missed the shot â€” they got away!</div>
    <div class="success-screen" id="success-screen">
      <span class="burst">ğŸ‰</span>
      <h3>CAUGHT!</h3>
      <p>${p.name} added to your JazzDex!</p>
    </div>`;

  document.getElementById('catch-modal').classList.add('open');
  initHoop();
}


/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HOOP MINI-GAME
   A single shot. An arc oscillates side to side.
   When it turns gold you're in the sweet spot â€” press THROW.
   Rarer players = faster oscillation = harder shot.

   â–¶ To change the sweet-spot size: edit sweetW (pixels of tolerance)
   â–¶ To change oscillation speed per rarity: edit AIM_SPEEDS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function initHoop() {
  const canvas = document.getElementById('hoop-cv');
  if (!canvas) return;
  const ctx = canvas.getContext('2d');
  const W = canvas.width, H = canvas.height;

  // Hoop position â€” fixed on right side of canvas
  const hoopX = W * 0.75;
  const hoopY = H * 0.30;
  const rimR  = 20;

  // Ball starts at bottom-left
  const ballX = W * 0.14;
  const ballY = H * 0.84;

  /* â–¶ TWEAK THESE to make catching easier/harder:
     sweetW   â€” half-width of the "in" zone (bigger = more forgiving)
     AIM_SPEEDS â€” how fast the arc oscillates per rarity */
  const sweetW     = 22;
  const AIM_SPEEDS = { common: 0.016, rare: 0.026, epic: 0.036, legendary: 0.050 };
  const speed      = AIM_SPEEDS[currentTarget.rarity];

  let aimAngle = 0;           // drives sin() oscillation
  let phase    = 'aim';       // 'aim' | 'fly'
  let flyT     = 0;
  let flyScatter = 0;
  let swish    = 0;           // flash intensity after a make

  // Current scatter: how far off-target the arc is (px)
  function scatter() { return Math.sin(aimAngle) * 58; }

  // Quadratic bezier from ball to target (hoopX + scatter offset)
  function arcPoint(t, sc) {
    const tx  = hoopX + sc;
    const cpX = (ballX + tx) * 0.5;
    const cpY = Math.min(ballY, hoopY) - H * 0.55;
    return {
      bx: (1-t)*(1-t)*ballX + 2*(1-t)*t*cpX + t*t*tx,
      by: (1-t)*(1-t)*ballY + 2*(1-t)*t*cpY + t*t*hoopY,
    };
  }

  // Draw a basketball circle with gradient and seams
  function drawBall(x, y, r = 11) {
    const g = ctx.createRadialGradient(x - r*.35, y - r*.35, r*.1, x, y, r);
    g.addColorStop(0, '#ffb347');
    g.addColorStop(1, '#c84800');
    ctx.beginPath(); ctx.arc(x, y, r, 0, Math.PI * 2);
    ctx.fillStyle = g; ctx.fill();
    ctx.strokeStyle = 'rgba(0,0,0,.3)'; ctx.lineWidth = 1.2;
    ctx.beginPath(); ctx.arc(x, y, r, -0.5, 0.5); ctx.stroke();
    ctx.beginPath(); ctx.arc(x, y, r, Math.PI - .5, Math.PI + .5); ctx.stroke();
  }

  function drawHoop() {
    // Backboard
    ctx.fillStyle = '#e0d8c0';
    ctx.fillRect(hoopX + rimR + 3, hoopY - 28, 7, 50);
    ctx.strokeStyle = '#bbb'; ctx.lineWidth = 1;
    ctx.strokeRect(hoopX + rimR + 3, hoopY - 28, 7, 50);
    // Net lines
    ctx.strokeStyle = 'rgba(255,255,255,.4)'; ctx.lineWidth = 1;
    for (let i = 0; i <= 4; i++) {
      const nx = hoopX - rimR + (rimR * 2 / 4) * i;
      ctx.beginPath();
      ctx.moveTo(nx, hoopY + 4);
      ctx.lineTo(hoopX + (nx - hoopX) * 0.4, hoopY + 26);
      ctx.stroke();
    }
    ctx.beginPath();
    ctx.moveTo(hoopX - rimR * .5, hoopY + 26);
    ctx.lineTo(hoopX + rimR * .5, hoopY + 26);
    ctx.stroke();
    // Rim
    ctx.strokeStyle = '#E05500'; ctx.lineWidth = 4.5;
    ctx.beginPath(); ctx.ellipse(hoopX, hoopY, rimR, 5, 0, 0, Math.PI * 2); ctx.stroke();
  }

  function frame() {
    ctx.clearRect(0, 0, W, H);
    drawHoop();

    // Gold swish flash after a make
    if (swish > 0) {
      ctx.globalAlpha = swish * 0.45;
      ctx.fillStyle = '#F9A01B';
      ctx.beginPath(); ctx.arc(hoopX, hoopY, rimR + 16, 0, Math.PI * 2); ctx.fill();
      ctx.globalAlpha = 1;
      swish = Math.max(0, swish - 0.06);
    }

    if (phase === 'aim') {
      aimAngle += speed;
      const sc      = scatter();
      const inZone  = Math.abs(sc) < sweetW;

      // Draw the trajectory arc (gold = in zone, dim white = outside)
      ctx.save();
      ctx.setLineDash([5, 5]);
      ctx.strokeStyle = inZone ? 'rgba(249,160,27,.95)' : 'rgba(255,255,255,.3)';
      ctx.lineWidth   = inZone ? 2.4 : 1.5;
      ctx.beginPath();
      for (let i = 0; i <= 40; i++) {
        const { bx, by } = arcPoint(i / 40, sc);
        i === 0 ? ctx.moveTo(bx, by) : ctx.lineTo(bx, by);
      }
      ctx.stroke();
      ctx.setLineDash([]);
      ctx.restore();

      // Highlight ring on hoop when in zone
      if (inZone) {
        ctx.strokeStyle = 'rgba(249,160,27,.5)'; ctx.lineWidth = 3;
        ctx.beginPath(); ctx.ellipse(hoopX, hoopY, rimR + 7, 8, 0, 0, Math.PI * 2); ctx.stroke();
      }

      drawBall(ballX, ballY);
      hoopAF = requestAnimationFrame(frame);

    } else if (phase === 'fly') {
      flyT += 0.032;
      const { bx, by } = arcPoint(flyT, flyScatter);
      drawBall(bx, by);

      if (flyT < 1) {
        hoopAF = requestAnimationFrame(frame);
      } else {
        // Resolve: made if scatter was within sweet zone when thrown
        resolveShot(Math.abs(flyScatter) < sweetW);
      }
    }
  }

  function resolveShot(made) {
    const pip = document.getElementById('sp0');
    if (made) {
      if (pip) { pip.classList.add('made'); pip.textContent = 'âœ“'; }
      swish = 1;
      // Short delay then unlock catch button
      cancelAnimationFrame(hoopAF);
      const tb = document.getElementById('throw-btn');
      if (tb) tb.disabled = true;
      // Draw final swish frame, then show catch button
      ctx.clearRect(0, 0, W, H); drawHoop();
      ctx.globalAlpha = 0.4; ctx.fillStyle = '#F9A01B';
      ctx.beginPath(); ctx.arc(hoopX, hoopY, rimR + 16, 0, Math.PI * 2); ctx.fill();
      ctx.globalAlpha = 1;
      setTimeout(() => {
        const cb = document.getElementById('catch-btn');
        if (cb) cb.style.display = 'block';
      }, 350);
    } else {
      if (pip) { pip.classList.add('miss'); pip.textContent = 'âœ—'; }
      cancelAnimationFrame(hoopAF);
      const tb = document.getElementById('throw-btn');
      if (tb) tb.disabled = true;
      setTimeout(() => {
        const fm = document.getElementById('fail-msg');
        if (fm) fm.style.display = 'block';
        setTimeout(closeModal, 1600);
      }, 300);
    }
  }

  // Called by THROW button â€” capture current scatter and launch the ball
  window._doThrow = () => {
    if (phase !== 'aim') return;
    flyScatter = scatter();
    flyT   = 0;
    phase  = 'fly';
  };

  hoopAF = requestAnimationFrame(frame);
}

function doThrow()  { if (window._doThrow) window._doThrow(); }

function doCatch() {
  const p = currentTarget;
  caught.add(p.id);
  updateCounts();
  doDeSpawn(p.id);  // remove from map
  if (hoopAF) cancelAnimationFrame(hoopAF);
  document.getElementById('catch-btn').style.display = 'none';
  document.getElementById('success-screen').style.display = 'block';
  setTimeout(closeModal, 1900);
  // Refresh court if it's open
  if (document.getElementById('court-view').classList.contains('active')) rebuildRoamers();
}

function closeModal() {
  if (hoopAF) cancelAnimationFrame(hoopAF);
  document.getElementById('catch-modal').classList.remove('open');
  window._doThrow = null;
  currentTarget   = null;
}


/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   UPDATE CAUGHT COUNT (header + dex progress bar)
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function updateCounts() {
  const n = caught.size;
  document.getElementById('caught-count').textContent = n;
  const dn = document.getElementById('dex-n');
  if (dn) dn.textContent = n;
  const df = document.getElementById('dex-fill');
  if (df) df.style.width = (n / 12 * 100) + '%';
}


/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PLAYER CARDS â€” flip on click
   Front shows the player photo (or character sprite if no photo).
   Back shows era, stats, and flavor quote.
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function renderCards() {
  const grid = document.getElementById('cards-grid');
  if (!grid) return;

  grid.innerHTML = PLAYERS.map(p => {
    const got   = caught.has(p.id);
    const face  = faceImages[p.id];

    /* FRONT FACE:
       If a face photo exists â†’ full-bleed image with name overlay.
       Otherwise â†’ character sprite with name/era text. */
    const frontFace = face
      ? `<div class="card-face card-front">
           <img class="card-front-img" src="${face}" alt="${p.name}"/>
           <div class="card-front-overlay">
             <div class="card-pname">${p.name}</div>
             <span class="card-rbadge rarity-${p.rarity}">${p.rarity}</span>
           </div>
         </div>`
      : `<div class="card-face card-front">
           <div class="card-front-noimg">
             <div class="card-char">${buildChar(p, 70)}</div>
             <div class="card-pname">${p.name}</div>
             <div class="card-era">${p.era}</div>
             <span class="card-rbadge rarity-${p.rarity}" style="margin-top:2px">${p.rarity}</span>
           </div>
         </div>`;

    /* BACK FACE: stats + quote */
    const backFace = `<div class="card-face card-back">
      <div class="card-back-inner">
        <div class="card-back-num">#${String(p.id).padStart(3,'0')}</div>
        <div class="card-back-name">${p.name}</div>
        <div class="card-back-era">${p.era}</div>
        <div class="card-back-stats">
          <div class="srow"><span class="sl">PPG</span><span class="sv">${p.ppg}</span></div>
          <div class="srow"><span class="sl">APG</span><span class="sv">${p.apg}</span></div>
          <div class="srow"><span class="sl">RPG</span><span class="sv">${p.rpg}</span></div>
          <div class="srow"><span class="sl">BLK</span><span class="sv">${p.blk}</span></div>
        </div>
        <div class="card-back-quote">"${p.quote}"</div>
        <div class="card-back-hint">tap to flip back</div>
      </div>
    </div>`;

    return `<div class="card-flip-wrap ${!got ? 'locked' : ''}" data-r="${p.rarity}"
              onclick="this.classList.toggle('flipped')">
      <div class="card-inner">
        ${frontFace}
        ${backFace}
      </div>
    </div>`;
  }).join('');
}


/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   JAZZDEX GRID
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function renderDex() {
  const grid = document.getElementById('dex-grid');
  if (!grid) return;
  updateCounts();
  grid.innerHTML = PLAYERS.map(p => {
    const got = caught.has(p.id);
    return `<div class="dex-slot ${got ? 'got' : ''}">
      <div class="dex-char">${buildChar(p, 42)}</div>
      <div class="dex-pname">${got ? p.short : '???'}</div>
    </div>`;
  }).join('');
}


/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   COURT VIEW â€” roaming players + canvas ball animation

   The canvas element has a higher z-index than the player divs,
   so the ball always renders in front of all characters.

   With 1 player  â†’ dribbling animation (ball bounces at their feet)
   With 2+ players â†’ passing animation (arc between players)
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function rebuildRoamers() {
  const court   = document.getElementById('roam-court');
  const footer  = document.getElementById('court-footer');
  const players = PLAYERS.filter(p => caught.has(p.id));

  // Stop any existing animations
  court.querySelectorAll('.roamer-div').forEach(r => r.remove());
  if (courtAF)   { cancelAnimationFrame(courtAF); courtAF = null; }
  if (roamTimer) { clearInterval(roamTimer); roamTimer = null; }

  // Size the canvas to match the court element
  const cv = document.getElementById('court-cv');
  if (cv) { cv.width = court.offsetWidth || 900; cv.height = court.offsetHeight || 490; }

  if (players.length === 0) {
    footer.textContent = 'Catch players on the map to see them roam here!';
    return;
  }

  footer.textContent = players.length === 1
    ? `${players[0].short} is warming up! ğŸ€`
    : `${players.length} players are running drills ğŸ€`;

  // Place each player on the court
  players.forEach(p => {
    if (!roamPos[p.id]) roamPos[p.id] = { x: 20 + Math.random() * 60, y: 20 + Math.random() * 60 };
    const el = document.createElement('div');
    el.className = 'roamer-div';
    el.id = 'rv-' + p.id;
    el.style.left = roamPos[p.id].x + '%';
    el.style.top  = roamPos[p.id].y + '%';
    el.innerHTML  = `${buildChar(p, 50)}
      <div class="roamer-tag" style="color:${RARITY_COLORS[p.rarity]}">${p.short}</div>`;
    court.appendChild(el);
  });

  // Roam positions update every ~4.5s (CSS transition handles smoothing)
  roamTimer = setInterval(() => {
    players.forEach(p => {
      const pos = roamPos[p.id];
      if (!pos) return;
      pos.x = Math.max(8,  Math.min(92, pos.x + (Math.random() - 0.5) * 14));
      pos.y = Math.max(10, Math.min(90, pos.y + (Math.random() - 0.5) * 14));
      const el = document.getElementById('rv-' + p.id);
      if (el) { el.style.left = pos.x + '%'; el.style.top = pos.y + '%'; }
    });
  }, 4500);

  // Start the ball animation on the canvas (in front of all players)
  if (players.length === 1) {
    startDribble(players[0]);
  } else {
    startPassing(players);
  }
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   DRIBBLE ANIMATION â€” single player bounces ball at their feet
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function startDribble(player) {
  const canvas = document.getElementById('court-cv');
  if (!canvas) return;
  const ctx = canvas.getContext('2d');
  let t = 0; // drives the bounce (0 â†’ 1 â†’ 0 cycling)
  let tDir = 1;
  const BOUNCE_SPEED = 0.045; // â–¶ change to speed up/slow down dribble

  function getPos() {
    const pos = roamPos[player.id] || { x: 50, y: 50 };
    return {
      x: (pos.x / 100) * canvas.width,
      y: (pos.y / 100) * canvas.height,
    };
  }

  function drawBall(x, y) {
    const r = 9;
    const g = ctx.createRadialGradient(x - r*.3, y - r*.3, r*.12, x, y, r);
    g.addColorStop(0, '#ffb347'); g.addColorStop(1, '#c84800');
    ctx.beginPath(); ctx.arc(x, y, r, 0, Math.PI * 2);
    ctx.fillStyle = g; ctx.fill();
    ctx.strokeStyle = 'rgba(0,0,0,.25)'; ctx.lineWidth = 1;
    ctx.beginPath(); ctx.arc(x, y, r, -0.4, 0.4); ctx.stroke();
  }

  function frame() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    const { x, y } = getPos();

    // Ball bounces between hand-height and floor using a parabolic ease
    const eased  = Math.pow(t, 0.6); // squish toward floor
    const ballY  = y - 5 + eased * 30; // 30px = bounce height
    const ballX  = x + 8; // slightly to the right

    // Shadow squishes on floor as ball hits
    const shadowScale = 0.5 + 0.5 * eased;
    ctx.globalAlpha = 0.25 * eased;
    ctx.fillStyle   = '#000';
    ctx.beginPath();
    ctx.ellipse(ballX, y + 4, 9 * shadowScale, 3 * shadowScale, 0, 0, Math.PI * 2);
    ctx.fill();
    ctx.globalAlpha = 1;

    drawBall(ballX, ballY);

    // Ping-pong t between 0 and 1
    t += tDir * BOUNCE_SPEED;
    if (t >= 1) { t = 1; tDir = -1; }
    if (t <= 0) { t = 0; tDir =  1; }

    courtAF = requestAnimationFrame(frame);
  }
  courtAF = requestAnimationFrame(frame);
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   PASSING ANIMATION â€” ball arcs between 2+ players
   Canvas z-index:3 ensures ball renders in front of all player divs.
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function startPassing(players) {
  const canvas = document.getElementById('court-cv');
  if (!canvas) return;
  const ctx    = canvas.getContext('2d');
  let fromIdx  = 0;
  let toIdx    = 1;
  let t        = 0;
  const PASS_SPEED = 0.012; // â–¶ change to speed up/slow down passes

  function getPos(p) {
    const pos = roamPos[p.id] || { x: 50, y: 50 };
    return { x: (pos.x / 100) * canvas.width, y: (pos.y / 100) * canvas.height };
  }

  // Quadratic bezier arc between two positions
  function arcPt(t, f, to) {
    const cpX = (f.x + to.x) * 0.5;
    const cpY = Math.min(f.y, to.y) - canvas.height * 0.28; // arc height
    return {
      x: (1-t)*(1-t)*f.x + 2*(1-t)*t*cpX + t*t*to.x,
      y: (1-t)*(1-t)*f.y + 2*(1-t)*t*cpY + t*t*to.y,
    };
  }

  function drawBall(x, y) {
    const r = 9;
    const g = ctx.createRadialGradient(x - r*.3, y - r*.3, r*.12, x, y, r);
    g.addColorStop(0, '#ffb347'); g.addColorStop(1, '#c84800');
    ctx.beginPath(); ctx.arc(x, y, r, 0, Math.PI * 2);
    ctx.fillStyle = g; ctx.fill();
    ctx.strokeStyle = 'rgba(0,0,0,.25)'; ctx.lineWidth = 1;
    ctx.beginPath(); ctx.arc(x, y, r, -0.4, 0.4); ctx.stroke();
  }

  function frame() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    const from = players[fromIdx];
    const to   = players[toIdx];
    if (!from || !to) { courtAF = requestAnimationFrame(frame); return; }

    const fp = getPos(from);
    const tp = getPos(to);
    t += PASS_SPEED;

    const { x: bx, y: by } = arcPt(t, fp, tp);

    // Floor shadow (lerps between sender/receiver floor Y)
    const floorY = fp.y + (tp.y - fp.y) * t;
    const ht     = Math.sin(Math.PI * t); // 0 at ends, 1 at peak
    ctx.save();
    ctx.globalAlpha = 0.22 * ht;
    ctx.fillStyle   = '#000';
    ctx.beginPath();
    ctx.ellipse(bx, floorY + 6, 10 * (.4 + .6 * ht), 3, 0, 0, Math.PI * 2);
    ctx.fill();
    ctx.restore();

    drawBall(bx, by);

    if (t >= 1) {
      // Pass complete â€” pick a new random recipient
      t       = 0;
      fromIdx = toIdx;
      const others = players.map((_, i) => i).filter(i => i !== fromIdx);
      toIdx   = others[Math.floor(Math.random() * others.length)];
      setTimeout(() => { courtAF = requestAnimationFrame(frame); }, 500);
      return;
    }
    courtAF = requestAnimationFrame(frame);
  }
  courtAF = requestAnimationFrame(frame);
}


/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   VIEW SWITCHER â€” handles nav button clicks
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function showView(id, btn) {
  document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
  document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  btn.classList.add('active');
  if (id === 'court-view')  rebuildRoamers();
  if (id === 'dex-view')    renderDex();
  if (id === 'cards-view')  renderCards();
  if (id === 'faces-view')  renderFaces();
}


/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   INIT â€” runs on page load
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
renderCards();
renderDex();
renderFaces();
scheduleAll();   // kick off the spawn timers
</script>
</body>
</html>
